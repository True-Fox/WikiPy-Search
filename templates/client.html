<!DOCTYPE html>
<html lang="en">
<head>
    <title>Document</title>
    <link rel="stylesheet" type ="text/css" href="{{url_for('static',filename='styles/main.css')}}">
    <script src=" https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.1/socket.io.min.js"></script>
    <script>
        $(document).ready(function(){
            var socket = io.connect('http://'+document.domain+':'+location.port);
            
            $('form').submit(function(event){
                event.preventDefault();
                $("#dis").empty()
                $('#results').empty()
                $('#image').empty()
                $("#summary").empty()
                $('#url').empty()
                var word = $("#searchKey").val();
                socket.emit('send list',{'searchKey':word});
            });
            
            socket.on('list response',function(data){

                    data.forEach(function(result){
                        $("#results").append($("<li>").text(result).click(function(){
                            var index = $(this).index()
                                socket.emit('select',{'searchKey':result, 'index':index})
                                }))
                    })
            })

            socket.on('disambi',function(data){
                $('#image').empty()
                $('#summary').empty()
                $('#dis').empty()
                $('#url').empty()
                console.log(data)
                data.forEach(function(result){
                    $("#dis").append($("<li>").text(result).click(function(){
                            var index = $(this).index()
                                socket.emit('disambiSelect',{'searchKey':result, 'index':index})
                                }))
                })
                $("#dis").show("1")
            })

            socket.on('message',function(data){
                $('#image').empty()
                $('#summary').empty()
                $('#dis').empty()
                $('#url').empty()
                var image = new Image();
                image.src = data['image']
                $('#image').append(image);
                $('#summary').append($('<p>').text(data['message']));
                url = data['url']
                $('#url').append("<a href =" + url + " target = '_blank'>For more info, click here</a>")
            })
        })
    </script>
</head>
<body>
    <h1>WikiPy Search</h1>
    <form>
        <input type="text" id="searchKey" placeholder="Enter a keyword...">
        <button type="submit">Search</button>
    </form>
    <ul id="results"></ul>
    <ul id="dis"></ul>
    <div id = "image"></div>
    <div id="summary"></div>
    <p id = "url"></p>
</body>
</html>
